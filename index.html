<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Our Duo App</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: #fff0f3; }
        #app { max-width: 400px; margin: 0 auto; height: 100vh; background: white; display: flex; flex-direction: column; }
        .header { padding: 15px; background: #ff4b5c; color: white; text-align: center; }
        .xp-bar { background: rgba(255,255,255,0.3); height: 8px; border-radius: 5px; margin-top: 10px; overflow: hidden; }
        #fill { background: white; height: 100%; width: 0%; transition: 0.5s; }
        .tabs { display: flex; background: #f8f9fa; border-bottom: 1px solid #eee; }
        .tab { flex: 1; padding: 12px; border: none; background: none; cursor: pointer; color: #888; font-weight: bold; }
        .tab.active { color: #ff4b5c; border-bottom: 3px solid #ff4b5c; }
        .screen { display: none; flex: 1; overflow-y: auto; padding: 15px; }
        .screen.active { display: flex; flex-direction: column; }
        #chat-list { flex: 1; overflow-y: auto; display: flex; flex-direction: column; gap: 8px; }
        .msg { background: #f1f1f1; padding: 10px; border-radius: 12px; max-width: 80%; align-self: flex-start; }
        .input-area { display: flex; gap: 8px; padding: 15px; border-top: 1px solid #eee; }
        input { flex: 1; padding: 12px; border-radius: 20px; border: 1px solid #ddd; outline: none; }
        .btn { background: #ff4b5c; color: white; border: none; padding: 10px 20px; border-radius: 20px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

<div id="app">
    <div class="header">
        <div style="font-weight: bold;">Together Hub</div>
        <div id="lvl" style="font-size: 12px; margin-top: 5px;">Level 1</div>
        <div class="xp-bar"><div id="fill"></div></div>
    </div>

    <div class="tabs">
        <button class="tab active" onclick="tab('chat')">Chat</button>
        <button class="tab" onclick="tab('gallery')">Gallery</button>
        <button class="tab" onclick="tab('plans')">Plans</button>
    </div>

    <div id="chat" class="screen active">
        <div id="chat-list"></div>
        <div class="input-area">
            <input type="text" id="text-in" placeholder="Type a message...">
            <button class="btn" onclick="send()">Send</button>
        </div>
    </div>

    <div id="gallery" class="screen">
        <h3>Shared Gallery</h3>
        <p>Photos will appear here!</p>
    </div>

    <div id="plans" class="screen">
        <h3>Our Plans</h3>
        <p>List your plans here.</p>
    </div>
</div>

<script>
    // --- STEP 1: CONFIG ---
    const URL = 'https://tvxpjkrwwlbnkblcqyqo.supabase.co';
    const KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR2eHBqa3J3d2xibmtibGNxeXFvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAyMDQ4NDAsImV4cCI6MjA4NTc4MDg0MH0.bSGUbOUnpRImgkoGsACvFG_bxtWtMsmhQ7TqBGSBl9U';
    
    // FIX: Using window.supabase (No "exports" needed!)
    const supabaseClient = window.supabase.createClient(URL, KEY);
    let myXp = 0;

    // --- STEP 2: LOAD ---
    async function load() {
        const { data, error } = await supabaseClient.from('messages').select('*').order('created_at', { ascending: true });
        if (data) {
            document.getElementById('chat-list').innerHTML = data.map(m => `<div class="msg">${m.content}</div>`).join('');
            const list = document.getElementById('chat-list');
            list.scrollTop = list.scrollHeight;
        }
    }

    // --- STEP 3: SEND ---
    async function send() {
        const input = document.getElementById('text-in');
        if (!input.value) return;

        await supabaseClient.from('messages').insert([{ content: input.value }]);
        input.value = '';
        
        myXp += 10;
        updateUI();
        load();
    }

    function updateUI() {
        const level = Math.floor(myXp / 100) + 1;
        document.getElementById('lvl').innerText = "Level " + level;
        document.getElementById('fill').style.width = (myXp % 100) + "%";
    }

    function tab(name) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.getElementById(name).classList.add('active');
        event.currentTarget.classList.add('active');
    }

    // Refresh chat every 2 seconds
    load();
    setInterval(load, 2000);
</script>

</body>
</html>