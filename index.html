<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Together Hub</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { margin: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #fce4ec; }
        #app { max-width: 400px; margin: 0 auto; height: 100vh; background: white; display: flex; flex-direction: column; box-shadow: 0 0 20px rgba(0,0,0,0.1); }
        
        /* Header */
        .header { padding: 15px; background: #ff4b5c; color: white; text-align: center; }
        .xp-bar-bg { background: rgba(255,255,255,0.3); height: 8px; border-radius: 5px; margin-top: 10px; }
        #xp-bar-fill { background: white; height: 100%; width: 0%; border-radius: 5px; transition: 0.5s; }

        /* Tabs */
        .tabs { display: flex; background: #f8f9fa; border-bottom: 1px solid #eee; }
        .tab { flex: 1; padding: 12px; border: none; background: none; cursor: pointer; color: #888; font-weight: bold; }
        .tab.active { color: #ff4b5c; border-bottom: 3px solid #ff4b5c; }

        /* Screens */
        .screen { display: none; flex: 1; overflow-y: auto; padding: 15px; }
        .screen.active { display: flex; flex-direction: column; }

        /* Chat */
        #chat-msgs { flex: 1; overflow-y: auto; display: flex; flex-direction: column; gap: 8px; }
        .msg { background: #f1f1f1; padding: 10px; border-radius: 12px; max-width: 80%; align-self: flex-start; }
        .input-box { display: flex; gap: 8px; padding: 10px; border-top: 1px solid #eee; }
        input { flex: 1; padding: 10px; border-radius: 20px; border: 1px solid #ddd; outline: none; }
        .btn { background: #ff4b5c; color: white; border: none; padding: 10px 15px; border-radius: 20px; cursor: pointer; }

        /* Gallery Grid */
        .gallery-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .photo-card { background: #eee; height: 150px; border-radius: 10px; display: flex; align-items: center; justify-content: center; color: #aaa; }
    </style>
</head>
<body>

<div id="app">
    <div class="header">
        <div style="font-weight: bold;">Together Hub</div>
        <div id="lvl-label" style="font-size: 12px; margin-top: 5px;">Level 1</div>
        <div class="xp-bar-bg"><div id="xp-bar-fill"></div></div>
    </div>

    <div class="tabs">
        <button class="tab active" onclick="show('chat')">Chat</button>
        <button class="tab" onclick="show('gallery')">Gallery</button>
        <button class="tab" onclick="show('plans')">Plans</button>
    </div>

    <div id="chat" class="screen active">
        <div id="chat-msgs"></div>
        <div class="input-box">
            <input type="text" id="chat-in" placeholder="Type a message...">
            <button class="btn" onclick="send()">Send</button>
        </div>
    </div>

    <div id="gallery" class="screen">
        <h3>Our Gallery</h3>
        <div class="gallery-grid">
            <div class="photo-card">Empty</div>
            <div class="photo-card">Empty</div>
        </div>
        <button class="btn" style="margin-top: 20px;">+ Upload Photo</button>
    </div>

    <div id="plans" class="screen">
        <h3>Relationship Plans</h3>
        <div style="background:#f9f9f9; padding: 15px; border-radius: 10px;">
            üìç No plans yet. Type one in chat!
        </div>
    </div>
</div>

<script>
    const CONF = {
        url: 'https://tvxpjkrwwlbnkblcqyqo.supabase.co',
        key: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR2eHBqa3J3d2xibmtibGNxeXFvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAyMDQ4NDAsImV4cCI6MjA4NTc4MDg0MH0.bSGUbOUnpRImgkoGsACvFG_bxtWtMsmhQ7TqBGSBl9U'
    };

    const sb = exports.createClient(CONF.url, CONF.key);
    let xp = 0;

    // Load messages
    async function load() {
        const { data } = await sb.from('messages').select('*').order('created_at', { ascending: true });
        if (data) {
            const box = document.getElementById('chat-msgs');
            box.innerHTML = data.map(m => `<div class="msg">${m.content}</div>`).join('');
            box.scrollTop = box.scrollHeight;
        }
    }

    // Send message
    async function send() {
        const el = document.getElementById('chat-in');
        if (!el.value) return;
        await sb.from('messages').insert([{ content: el.value }]);
        el.value = '';
        xp += 10;
        updateXP();
        load();
    }

    function updateXP() {
        const lvl = Math.floor(xp / 100) + 1;
        document.getElementById('lvl-label').innerText = "Level " + lvl;
        document.getElementById('xp-bar-fill').style.width = (xp % 100) + "%";
    }

    function show(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        event.currentTarget.classList.add('active');
    }

    // Listen for Enter key
    document.getElementById('chat-in').addEventListener('keypress', e => { if(e.key==='Enter') send(); });

    // Refresh every 3 seconds
    load();
    setInterval(load, 3000);
</script>

</body>
</html>